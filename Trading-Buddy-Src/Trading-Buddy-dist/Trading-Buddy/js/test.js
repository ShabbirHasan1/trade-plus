let RESP_OBJ=JSON.parse('{"sEcho":1,"iTotalRecords":21,"iTotalDisplayRecords":21,"aaData":[["-","-","-","0.0000","0.0000","0.0000","0.0000","-","0.00","-",null,null,"-","0.00",null,null,null,"1980","0.00","0.70","0.10","0.10","-","750","12500",0,"0.00","-","0.0000","0.0000","0.0000","0.0000","-","-","27-Jul-2022_15:27:23","-","-"],["-","-","28-Jul-2022_12:09:41","0.0000","0.0000","0.0000","0.0000","-","0.00",0,"500","250","11.15","179.85","179.85","188.15","192.40","2000","0.05","0.15","0.09","0.05","-0.10","30000","284000",-9250,"169.47","104.42","0.0000","0.0000","0.0000","0.0000","568.00","120.00","28-Jul-2022_12:06:20","Bullish","LU"],["-","-","-","0.0000","0.0000","0.0000","0.0000","-","0.00","-",null,null,"-","0.00",null,null,null,"2020","0.05","0.25","0.14","0.05","-0.05","4500","21750",-3500,"130.57","72.08","0.0000","0.0000","0.0000","0.0000","-","-","28-Jul-2022_11:28:45","Bullish","LU"],["-","-","-","0.0000","0.0000","0.0000","0.0000","-","0.00","-",null,null,"-","0.00",null,null,null,"2040","0.05","0.25","0.05","0.05","-0.10","750","33500",-500,"0.00","-","0.0000","0.0000","0.0000","0.0000","-","-","28-Jul-2022_12:08:08","Bullish","LU"],["-","-","-","0.0000","0.0000","0.0000","0.0000","-","0.00","-",null,null,"-","0.00",null,null,null,"2060","0.05","0.15","0.08","0.05","-0.15","15250","43750",-8000,"110.96","61.63","0.0000","0.0000","0.0000","0.0000","-","-","28-Jul-2022_11:46:31","Bullish","LU"],["-","-","28-Jul-2022_12:09:41","0.0000","0.0000","0.0000","0.0000","-","0.00",0,"1750","500","5.00","110.95","105.45","108.30","113.40","2080","0.10","0.30","0.15","0.30","0.15","3250","31250",-1000,"107.93","67.23","0.0000","0.0000","0.0000","0.0000","17.86","6.50","28-Jul-2022_12:06:41","Bearish","SC"],["LU","Bearish","28-Jul-2022_12:09:59","0.0000","0.0000","0.0000","1.0000","14.15","89.90",-1750,"21250","2000","-12.70","79.80","80.25","86.05","91.30","2100","0.00","0.05","0.05","0.05","-0.05","7750","204750",-4250,"72.16","42.54","0.0000","0.0000","0.0000","0.0000","9.64","3.88","28-Jul-2022_12:05:58","Bullish","LU"],["LU","Bearish","28-Jul-2022_12:09:59","0.0000","-0.0002","0.0000","1.0000","26.66","79.68",-500,"36250","1000","-3.45","66.70","63.48","65.90","71.25","2120","0.00","0.05","0.05","0.05","-0.10","4000","67000",-2250,"43.54","16.80","-0.0002","0.0001","-0.0327","0.0005","1.85","4.00","28-Jul-2022_12:08:09","Bullish","LU"],["LU","Bearish","28-Jul-2022_12:09:59","0.0002","-0.0206","0.0000","0.9999","28.75","65.86",-2500,"35250","13500","-0.85","48.50","48.10","45.90","51.20","2140","0.00","0.05","0.05","0.05","-0.15","22750","141500",-13750,"48.20","28.65","-0.0023","0.0004","-0.4452","0.0032","4.01","1.69","28-Jul-2022_12:05:12","Bullish","LU"],["SC","Bullish","28-Jul-2022_12:09:41","0.0150","-1.6810","0.0025","0.9864","-8.24","29.24",-6000,"37000","9000","0.45","32.30","23.41","28.50","31.05","2160","0.00","0.05","0.16","0.05","-0.55","46500","313500",-2500,"20.98","5.10","-0.0499","0.0071","-3.7261","0.0526","8.47","5.17","28-Jul-2022_12:09:41","Bullish","LU"],["LU","Bearish","28-Jul-2022_12:09:56","0.1359","-16.3479","0.0216","0.7533","3.20","26.50",-7000,"32500","65000","-1.60","12.70","9.18","12.00","13.95","2180","2.50","3.15","3.93","3.20","-0.40","65250","67000",-14750,"38.25","21.66","-0.2318","0.0223","-14.7613","0.1314","2.06","1.00","28-Jul-2022_12:09:41","Bullish","LU"],["LU","Bearish","28-Jul-2022_12:09:41","0.1472","-22.2326","0.0190","0.2921","19.40","46.19",-50000,"295000","244250","-3.00","4.20","3.08","3.80","4.30","2200","12.95","15.25","17.19","13.95","-2.65","22250","55000",-3750,"41.71","11.34","-0.7675","0.0224","-14.7855","0.1316","0.19","0.09","28-Jul-2022_12:09:41","Bullish","LU"],["LU","Bearish","28-Jul-2022_12:09:41","0.0172","-1.9865","0.0029","0.0160","14.86","42.69",-36000,"46500","86250","-2.60","0.30","0.60","0.25","0.30","2220","28.15","31.50","36.70","29.40","-12.60","2250","6500",-1750,"62.47","-30.42","-0.9845","0.0027","-1.6091","0.0188","0.14","0.03","28-Jul-2022_12:09:41","Bullish","LU"],["LU","Bearish","28-Jul-2022_12:09:41","0.0002","-0.0278","0.0000","0.0001","25.21","58.95",-17500,"37750","37250","-1.05","0.25","0.31","0.25","0.30","2240","24.50","54.15","51.25","48.10","-","2000","2250",0,"0.00","-","0.0000","0.0000","0.0000","0.0000","0.06","0.05","27-Jul-2022_15:29:58","-","-"],["LU","Bearish","28-Jul-2022_12:09:18","0.0000","-0.0001","0.0000","0.0000","26.37","63.78",-5750,"27500","16250","-0.40","0.20","0.23","0.15","0.35","2260","44.15","77.35","70.20","70.20","-","250","500",-250,"0.00","-","0.0000","0.0000","0.0000","0.0000","0.02","0.02","22-Jul-2022_15:29:54","-","-"],["LU","Bearish","28-Jul-2022_11:29:08","0.0000","0.0000","0.0000","0.0000","31.95","74.92",-250,"7750","2000","-0.45","0.10","0.11","0.10","2.00","2280",null,null,null,"0.00","-",null,null,"-","0.00","-","0.0000","0.0000","0.0000","0.0000","-","-","-","-","-"],["LU","Bearish","28-Jul-2022_12:09:18","0.0000","0.0000","0.0000","0.0000","60.57","109.34",-19500,"68250","24750","-0.20","0.25","0.15","0.20","0.30","2300","107.20","114.70","111.00","111.00","-","250","2250",250,"0.00","-","0.0000","0.0000","0.0000","0.0000","0.03","0.01","27-Jul-2022_15:29:58","-","-"],["LU","Bearish","28-Jul-2022_12:09:41","0.0000","0.0000","0.0000","0.0000","45.75","100.54",-3500,"20250","3750","-0.25","0.20","0.14","0.10","0.20","2320",null,null,null,"0.00","-",null,null,"-","0.00","-","0.0000","0.0000","0.0000","0.0000","-","-","-","-","-"],["LU","Bearish","28-Jul-2022_12:09:41","0.0000","0.0000","0.0000","0.0000","-","0.00",-500,"13500","1000","-0.30","0.10","0.11","0.10","0.40","2340",null,null,null,"0.00","-",null,null,"-","0.00","-","0.0000","0.0000","0.0000","0.0000","-","-","-","-","-"],["-","-","18-Jul-2022_15:29:58","0.0000","0.0000","0.0000","0.0000","-","0.00",0,"2250","1000","-","0.70","0.85","0.05","0.70","2360",null,null,null,"0.00","-",null,null,"-","0.00","-","0.0000","0.0000","0.0000","0.0000","-","-","-","-","-"],["LU","Bearish","28-Jul-2022_11:56:15","0.0000","0.0000","0.0000","0.0000","67.48","146.68",-9000,"35000","16000","-0.30","0.05","0.11","0.00","0.05","2400","183.25","215.80","221.00","221.00","-","500","250",0,"0.00","-","0.0000","0.0000","0.0000","0.0000","0.01","0.03","27-Jul-2022_15:29:58","-","-"]],"strikePriceATM":"2180.00","futuresPriceStr":"ACC-28JUL22 Futures Closing Price: <b>2,189.85</b> (As of 28-Jul-2022 12:09)","symbol_1":"ACC","optExpDate":"28JUL22","monthlyExpDate":"28JUL22","dt":"2022-07-28","futuresClosingPrice":"2,189.85","TimeStamp":"28-Jul-2022 12:09","futures_close_chg":"-1.15","futures_close_chg_percent":"-0.05","maxcalloi":"295000","mincalloi":"500","maxputoi":"313500","minputoi":"250","maxoichangecall":0,"minoichangecall":-50000,"maxoichangeput":250,"minoichangeput":-14750,"maxcallvol":"244250","maxputvol":"65250","total_call_oi":718250,"total_put_oi":1287250,"total_call_oi_change":-159750,"total_put_oi_change":-65250,"total_call_volume":523750,"total_put_volume":228250,"diffoichange":94500,"lot_size":"250","defaultDatedMY":"28-Jul-2022"}');const WEAK_THEASHOLD=20,COL_MAP={CALL_OI_CHANGE:9,CE_DELTA:6,CE_THETA:4,CALL_OI:10,STRIKE_PRICE:17,CE_VWAP:14,PE_VWAP:20,PUT_OI:24,PUT_OI_CHANGE:25,CE_LTP:13,PE_LTP:21,PE_DELTA:28,PE_THETA:30,OI_PCR:32};async function getIOData(e){return RESP_OBJ}function getImaginoryLinePair(l,a){return strikePair=[0,0],l.some((e,t)=>parseFloat(a)<parseFloat(e)&&(strikePair[0]={index:t-1,strike:parseFloat(l[t-1]).toFixed(2)},strikePair[1]={index:t,strike:parseFloat(l[t]).toFixed(2)},!0)),strikePair}function getOIDataObj(e){return oiChainObj={},e.aaData.forEach((e,t)=>{var l=parseFloat(e[COL_MAP.STRIKE_PRICE]).toFixed(2),a=l+"-PE";oiChainObj[l+"-CE"]={strikePrice:l,openInterest:e[COL_MAP.CALL_OI],changeinOpenInterest:e[COL_MAP.CALL_OI_CHANGE],lastPrice:e[COL_MAP.CE_LTP],delta:e[COL_MAP.CE_DELTA],index:t},oiChainObj[a]={strikePrice:l,openInterest:e[COL_MAP.PUT_OI],changeinOpenInterest:e[COL_MAP.PUT_OI_CHANGE],lastPrice:e[COL_MAP.PE_LTP],delta:e[COL_MAP.PE_DELTA],index:t}}),oiChainObj}function getSupportResistanc(t,l,a,e){let r=a[l[0].index]+"-CE",i=a[l[0].index]+"-PE",n=[],s=0,u=0,o=0,_=0,c=1;for(let e=l[0].index;e<a.length&&(t[r]&&t[i]&&(n.push({strike:t[r].strikePrice,oi:t[r].openInterest,volume:t[r].totalTradedVolume,index:t[r].index,strength:t[r].totalTradedVolume+t[r].openInterest+t[r].changeinOpenInterest}),0==t[i].lastPrice&&s++,t[i].changeinOpenInterest<0&&u++,r=a[e+1]+"-CE",i=a[e+1]+"-PE"),10!=++c);e++);i=a[l[1].index]+"-PE",r=a[l[1].index]+"-CE";let p=[];for(let e=l[c=1].index;0<=e&&(t[i]&&(p.push({strike:t[i].strikePrice,oi:t[i].openInterest,volume:t[i].totalTradedVolume,index:t[i].index,strength:t[i].totalTradedVolume+t[i].openInterest+t[i].changeinOpenInterest}),0==t[r].lastPrice&&o++,t[r].changeinOpenInterest<0&&_++,i=a[e-1]+"-PE",r=a[e-1]+"-CE"),10!=++c);e--);let h=l[0].strike,P=l[1].strike,C=0,L=0,E="N/A",d="N/A";var O;2<p.length&&2<n.length&&(sortByKey(p,"volume"),l=p[0].strike,sortByKey(p,"oi"),O=p[0].strike,h=parseFloat(Math.max(l,O)).toFixed(2),sortByKey(n,"volume"),l=n[0].strike,sortByKey(n,"oi"),O=n[0].strike,P=parseFloat(Math.min(l,O)).toFixed(2),r=h+"-CE",i=a[t[r].index-1]+"-PE",t[r]&&t[i]&&(L=ltpCalculator("Bearish",t[r].lastPrice,t[r].delta,t[i].lastPrice,t[i].delta,e)),i=P+"-PE",r=a[t[i].index+1]+"-CE",t[r]&&t[i]&&(C=ltpCalculator("Bullish",t[r].lastPrice,t[r].delta,t[i].lastPrice,t[i].delta,e)),d=checkForWeakSR(p,"support",h),E=checkForWeakSR(n,"resistance",P));let T=5;"S-STRONG"!==d&&"S-W.T.T"!==d||T--,3<=s-o&&T--,"R-STRONG"!==E&&"R-W.T.T"!==E||T--,_>u&&T--,O=T+"-STAR";let g=5;return"R-STRONG"!==E&&"R-W.T.B"!==E||g--,3<=o-s&&g--,"S-STRONG"!==d&&"S-W.T.B"!==d||g--,u>_&&g--,e=g+"-STAR",{resistance:P,support:h,eor:C,eos:L,supportStrength:d,resistanceStrength:E,peZeroCounter:s,ceZeroCounter:o,peOIChangeCounter:u,ceOIChangeCounter:_,buyRating:O,sellRating:e}}function ltpCalculator(e,t,l,a,r,i){let n=0;return n="error"==e?"No Pair Data":"Bullish"==e?parseFloat(a)<parseFloat(t)?"Breakout":(n=i+(parseFloat(a)-parseFloat(t))/(l+Math.abs(r))+.05,isNumeric(parseFloat(n).toFixed(2))?parseFloat(n).toFixed(2):"Data Error"):parseFloat(t)<parseFloat(a)?"Breakdown":(n=i-(parseFloat(t)-parseFloat(a))/(l+Math.abs(r))-.05,isNumeric(parseFloat(n).toFixed(2))?parseFloat(n).toFixed(2):"Data Error"),n}function sortByKey(e,l){return e.sort((e,t)=>t[l]-e[l])}function isNumeric(e){return"string"==typeof e&&(!isNaN(e)&&!isNaN(parseFloat(e)))}function checkForWeakSR(e,t,l){srItem=e.filter(e=>e.strike===l)[0];let a={};sortByKey(e,"strength");var r=srItem.strength;let i=0;return a=e[0].strike==srItem.strike?(i=e[1].strength,e[1]):(i=e[0].strength,e[0]),i>=r||Math.abs(r-i)/Math.max(r,i)*100<WEAK_THEASHOLD?"support"==t?srItem.index>a.index?"S-W.T.B":"S-W.T.T":srItem.index<a.index?"R-W.T.T":"R-W.T.B":"support"==t?"S-STRONG":"R-STRONG"}async function getSupportResistance(e){let t=await getIOData(e);var l=t.aaData.map(e=>parseFloat(e[COL_MAP.STRIKE_PRICE]).toFixed(2)),a=parseFloat(t.futuresClosingPrice.replace(",","")).toFixed(2),r=getImaginoryLinePair(l,a),i=getOIDataObj(t);return sr=getSupportResistanc(i,r,l,a),sr.symbol=e,sr.futPrice=a,sr}async function main(){let e=[];for(scrip of["AXISBANK"])e.push(await getSupportResistance(scrip));console.log(e)}main();